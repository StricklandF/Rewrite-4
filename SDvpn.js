
/*
 * 赛盾VPN
 * 提取节点

[rewrite_local]

^http:\/\/.*\.aliyunga0019\.com\/saidun\/version2\/v2_node_protocol url script-response-body https://raw.githubusercontent.com/Yu9191/Rewrite/main/SDvpn.js
[mitm]

hostname = *.aliyunga0019.com

*/
var iｉl='jsjiami.com.v7';const iliIlili=ll1llilI;(function(i11lill1,iilIiiii,IiIiiii,IilIilI,IiiillI1,IliIiI11,Il1IlIil){return i11lill1=i11lill1>>0x5,IliIiI11='hs',Il1IlIil='hs',function(l1iI11i,Iii111I1,li11l111,llIi1IiI,I11IlIIl){const I1iiIli1=ll1llilI;llIi1IiI='tfi',IliIiI11=llIi1IiI+IliIiI11,I11IlIIl='up',Il1IlIil+=I11IlIIl,IliIiI11=li11l111(IliIiI11),Il1IlIil=li11l111(Il1IlIil),li11l111=0x0;const l1IiiIII=l1iI11i();while(!![]&&--IilIilI+Iii111I1){try{llIi1IiI=-parseInt(I1iiIli1(0x148,'xLya'))/0x1*(-parseInt(I1iiIli1(0x153,'4myw'))/0x2)+parseInt(I1iiIli1(0x172,'xegx'))/0x3*(-parseInt(I1iiIli1(0x13b,'&roT'))/0x4)+parseInt(I1iiIli1(0x14e,'[VY9'))/0x5+-parseInt(I1iiIli1(0x179,'jRIG'))/0x6*(parseInt(I1iiIli1(0x155,'LcHt'))/0x7)+-parseInt(I1iiIli1(0x131,'aX64'))/0x8*(parseInt(I1iiIli1(0x177,'J@yW'))/0x9)+parseInt(I1iiIli1(0x13e,'Yr*5'))/0xa+-parseInt(I1iiIli1(0x145,'9KCe'))/0xb;}catch(iiiiIlii){llIi1IiI=li11l111;}finally{I11IlIIl=l1IiiIII[IliIiI11]();if(i11lill1<=IilIilI)li11l111?IiiillI1?llIi1IiI=I11IlIIl:IiiillI1=I11IlIIl:li11l111=I11IlIIl;else{if(li11l111==IiiillI1['replace'](/[GfQxhCRAWykJrgSLuFNp=]/g,'')){if(llIi1IiI===Iii111I1){l1IiiIII['un'+IliIiI11](I11IlIIl);break;}l1IiiIII[Il1IlIil](I11IlIIl);}}}}}(IiIiiii,iilIiiii,function(lIll1lll,il11I111,I1ll1iii,IIl1Ili,i1IlIl1,Ii1i1I1,lli1i11I){return il11I111='\x73\x70\x6c\x69\x74',lIll1lll=arguments[0x0],lIll1lll=lIll1lll[il11I111](''),I1ll1iii='\x72\x65\x76\x65\x72\x73\x65',lIll1lll=lIll1lll[I1ll1iii]('\x76'),IIl1Ili='\x6a\x6f\x69\x6e',(0x1842a0,lIll1lll[IIl1Ili](''));});}(0x17c0,0x72123,i1iIiI,0xc0),i1iIiI)&&(iｉl=0x1d04);const $=new Env(iliIlili(0xfe,'4CfO'),{'logLevel':iliIlili(0x12a,'RcGS')});function ll1llilI(_0x4e726d,_0x558231){const _0x524df1=i1iIiI();return ll1llilI=function(_0x57d767,_0x37f282){_0x57d767=_0x57d767-0xf9;let _0x56cdc6=_0x524df1[_0x57d767];if(ll1llilI['toTmLl']===undefined){var _0x2f0c36=function(_0x57a100){const _0x384c47='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x370e32='',_0x2423ed='';for(let _0x5e1231=0x0,_0x208dca,_0x1210cc,_0x410b7c=0x0;_0x1210cc=_0x57a100['charAt'](_0x410b7c++);~_0x1210cc&&(_0x208dca=_0x5e1231%0x4?_0x208dca*0x40+_0x1210cc:_0x1210cc,_0x5e1231++%0x4)?_0x370e32+=String['fromCharCode'](0xff&_0x208dca>>(-0x2*_0x5e1231&0x6)):0x0){_0x1210cc=_0x384c47['indexOf'](_0x1210cc);}for(let _0x31a707=0x0,_0x33ea5c=_0x370e32['length'];_0x31a707<_0x33ea5c;_0x31a707++){_0x2423ed+='%'+('00'+_0x370e32['charCodeAt'](_0x31a707)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x2423ed);};const _0xbacde0=function(_0x105d91,_0x55ae55){let _0x68608a=[],_0x569068=0x0,_0x47719f,_0x2b368d='';_0x105d91=_0x2f0c36(_0x105d91);let _0x5352b7;for(_0x5352b7=0x0;_0x5352b7<0x100;_0x5352b7++){_0x68608a[_0x5352b7]=_0x5352b7;}for(_0x5352b7=0x0;_0x5352b7<0x100;_0x5352b7++){_0x569068=(_0x569068+_0x68608a[_0x5352b7]+_0x55ae55['charCodeAt'](_0x5352b7%_0x55ae55['length']))%0x100,_0x47719f=_0x68608a[_0x5352b7],_0x68608a[_0x5352b7]=_0x68608a[_0x569068],_0x68608a[_0x569068]=_0x47719f;}_0x5352b7=0x0,_0x569068=0x0;for(let _0x35542e=0x0;_0x35542e<_0x105d91['length'];_0x35542e++){_0x5352b7=(_0x5352b7+0x1)%0x100,_0x569068=(_0x569068+_0x68608a[_0x5352b7])%0x100,_0x47719f=_0x68608a[_0x5352b7],_0x68608a[_0x5352b7]=_0x68608a[_0x569068],_0x68608a[_0x569068]=_0x47719f,_0x2b368d+=String['fromCharCode'](_0x105d91['charCodeAt'](_0x35542e)^_0x68608a[(_0x68608a[_0x5352b7]+_0x68608a[_0x569068])%0x100]);}return _0x2b368d;};ll1llilI['hwUJdO']=_0xbacde0,_0x4e726d=arguments,ll1llilI['toTmLl']=!![];}const _0x2a1c85=_0x524df1[0x0],_0x14bf8e=_0x57d767+_0x2a1c85,_0x1e40e1=_0x4e726d[_0x14bf8e];return!_0x1e40e1?(ll1llilI['rDkuQG']===undefined&&(ll1llilI['rDkuQG']=!![]),_0x56cdc6=ll1llilI['hwUJdO'](_0x56cdc6,_0x37f282),_0x4e726d[_0x14bf8e]=_0x56cdc6):_0x56cdc6=_0x1e40e1,_0x56cdc6;},ll1llilI(_0x4e726d,_0x558231);}var body=$response[iliIlili(0x132,'xegx')];$[iliIlili(0x146,'rvYu')](body);const code=/"code":(\d+)/[iliIlili(0x12d,'W(n6')](body)?.[0x1]||0x0;$[iliIlili(0x11a,'8Uvg')](iliIlili(0x141,'A&!F')+code);code!=0xc8?($[iliIlili(0x11e,'9KCe')](iliIlili(0x17c,'SXcB')+(body[iliIlili(0x152,'xegx')]||iliIlili(0x17b,'@@Ra'))),$[iliIlili(0x171,'4CfO')]({})):((async()=>{const liIlili=iliIlili,i1iI11i={'UYnRt':function(l1Ii1II,i1111i1i){return l1Ii1II+i1111i1i;},'hADLU':liIlili(0x13f,'lQUI'),'Biiss':liIlili(0x11d,'%^cp'),'kjUww':liIlili(0x182,'LcHt'),'mZBoP':function(lI11lIi1,IlliillI){return lI11lIi1(IlliillI);},'isleG':function(lilII1){return lilII1();},'ogXrP':function(lIlI1Ill,iIIiii){return lIlI1Ill===iIIiii;},'LPojY':liIlili(0x14f,'RM1x'),'jdUQW':liIlili(0x16b,'4YuZ'),'SKONX':liIlili(0x140,'DMN8'),'TysoV':function(Illil1i,IlII1iil){return Illil1i+IlII1iil;},'Ufbnv':liIlili(0x17f,'K0T0'),'pAZek':function(lIlli1II,IIlIl11){return lIlli1II!==IIlIl11;},'UpvBC':liIlili(0x105,'%^cp'),'UZWjC':liIlili(0x166,'8Uvg'),'fTOjF':liIlili(0x122,'RcGS'),'LruGn':liIlili(0x108,'W(n6'),'HeIwf':liIlili(0x163,'UDWN'),'oDOpq':function(iIlI1ill,i11lll1i,i11IIII,Iii1I1i,ii11l1i){return iIlI1ill(i11lll1i,i11IIII,Iii1I1i,ii11l1i);},'iRorG':liIlili(0x173,'@@Ra'),'coipT':liIlili(0x174,'8zUK'),'xoQPa':liIlili(0x144,'mxz8'),'zjQOM':function(l1lilIIl,i1iIIllI){return l1lilIIl===i1iIIllI;},'wviNb':liIlili(0x186,'4myw')};try{if(i1iI11i[liIlili(0x16e,'K0T0')](i1iI11i[liIlili(0x15d,'nlQ)')],i1iI11i[liIlili(0x167,'jRIG')]))liIII1l1[liIlili(0x104,'7w(D')](i1iI11i[liIlili(0x139,'SXcB')](i1iI11i[liIlili(0x16d,'Q9h^')],l1IIlIl1[liIlili(0x178,'vHq]')]||i1iI11i[liIlili(0x125,'J80q')])),i1Il1iII[liIlili(0x15c,'^(U2')]({});else{const IIl1lIil=await i1iI11i[liIlili(0x10a,'i6kV')](loadUtils);$[liIlili(0x11f,'SXAy')](i1iI11i[liIlili(0x16a,'^(U2')]),$[liIlili(0xfb,'V0km')](i1iI11i[liIlili(0x15e,'UDWN')](i1iI11i[liIlili(0x120,'6oST')],JSON[liIlili(0x128,'NyrC')](IIl1lIil)));if(!IIl1lIil||i1iI11i[liIlili(0x127,'4myw')](typeof IIl1lIil[liIlili(0x118,'YrA(')],i1iI11i[liIlili(0x113,'A&!F')]))throw new ReferenceError(i1iI11i[liIlili(0x10d,'aX64')]);const I11iIll1=IIl1lIil[liIlili(0x10e,'DMN8')]();$[liIlili(0x12e,'RcGS')](i1iI11i[liIlili(0x175,'Yr*5')]);if(!I11iIll1){if(i1iI11i[liIlili(0x127,'4myw')](i1iI11i[liIlili(0x151,'SXAy')],i1iI11i[liIlili(0x157,'UDWN')]))throw new Iii1llIl(i1iI11i[liIlili(0x115,'9KCe')]);else throw new ReferenceError(i1iI11i[liIlili(0x126,'4CfO')]);}body=$[liIlili(0x110,'Q9h^')](body);const l1IiIlll=body[liIlili(0x130,'b#15')][liIlili(0x12b,'V0km')],lIIllIlI=I11iIll1[liIlili(0x16f,'YrA(')][liIlili(0x176,'YrA(')][liIlili(0x137,'A&!F')](i1iI11i[liIlili(0x169,'^(U2')]),iiliI=I11iIll1[liIlili(0x10b,'xegx')][liIlili(0x10c,'8zUK')][liIlili(0x109,'SXcB')](i1iI11i[liIlili(0x103,'xLya')]),iIl11111=i1iI11i[liIlili(0x114,'s$SK')](AES_Decrypt,l1IiIlll,lIIllIlI,iiliI,I11iIll1);$[liIlili(0x14d,'&roT')](i1iI11i[liIlili(0x136,'K0T0')](i1iI11i[liIlili(0x106,'jRIG')],iIl11111)),$[liIlili(0x101,'DMN8')]($[liIlili(0x168,'vHq]')],i1iI11i[liIlili(0x183,'8f(C')],i1iI11i[liIlili(0x119,'NyrC')][liIlili(0x143,'z8d$')](iIl11111));}}catch(iI111lII){if(i1iI11i[liIlili(0x111,'D)a(')](i1iI11i[liIlili(0x13d,'[VY9')],i1iI11i[liIlili(0xff,'&roT')]))$[liIlili(0x159,'aX64')](iI111lII);else return IiI1IIii[liIlili(0x12f,'LcHt')]('✅\x20'+Iilliil1[liIlili(0x165,'^(U2')]+liIlili(0x164,'n(&n')),i1iI11i[liIlili(0x121,'T2zj')](lli1IlII,IiiIilli),i1iI11i[liIlili(0x158,'RcGS')](IIiiI1);}finally{$[liIlili(0xfd,'SXcB')]({'body':body});}})());function AES_Decrypt(lIIl1ilI,lIIl1Iil,lIIllli1,ilil1i1I){const l1ilIilI=iliIlili;var Iilllll=ilil1i1I[l1ilIilI(0xfc,'V0km')][l1ilIilI(0x14c,'xLya')](lIIl1ilI,lIIl1Iil,{'iv':lIIllli1,'mode':ilil1i1I[l1ilIilI(0x102,'i6kV')][l1ilIilI(0x14a,'K0T0')],'padding':ilil1i1I[l1ilIilI(0x185,'@@Ra')][l1ilIilI(0x11b,'vHq]')]});return Iilllll[l1ilIilI(0x17e,'K0T0')](ilil1i1I[l1ilIilI(0x10b,'xegx')][l1ilIilI(0x15b,'9KCe')]);}async function loadUtils(){const Ill1ili=iliIlili,lil11i1i={'fmjOf':Ill1ili(0x154,'V0km'),'jpywM':function(liiIil,iiiIil11){return liiIil(iiiIil11);},'Gsgub':function(i1IiI1Il,IIi1IIii){return i1IiI1Il(IIi1IIii);},'yMQDX':function(lIIllI11){return lIIllI11();},'QjXqo':Ill1ili(0x133,'mxz8'),'UcsnQ':function(lIIiiIl1,Il1lIl11){return lIIiiIl1(Il1lIl11);},'gXgHI':function(I1illill){return I1illill();}};let llil1Ill=$[Ill1ili(0x112,'8zUK')](lil11i1i[Ill1ili(0xfa,'o&n$')])||'';if(llil1Ill&&llil1Ill[Ill1ili(0x116,'A&!F')])return console[Ill1ili(0x11f,'SXAy')]('✅\x20'+$[Ill1ili(0x161,'SXAy')]+Ill1ili(0x15a,'#kUD')),lil11i1i[Ill1ili(0x160,'aX64')](eval,llil1Ill),lil11i1i[Ill1ili(0x15f,'4CfO')](creatUtils);return console[Ill1ili(0x135,'A&!F')](Ill1ili(0x170,'YrA(')+$[Ill1ili(0x180,'4YuZ')]+Ill1ili(0x142,'o&n$')),new Promise(liI11lii=>{const IiIl1ill=Ill1ili,IIlliIIi={'doplG':lil11i1i[IiIl1ill(0x138,'mxz8')],'WROYb':function(l11I11iI,Ii11Ili){const lIIiIii=IiIl1ill;return lil11i1i[lIIiIii(0x147,'[VY9')](l11I11iI,Ii11Ili);},'mqLsr':function(l1l111I,il11IllI){const IIl11ilI=IiIl1ill;return lil11i1i[IIl11ilI(0x162,'SXAy')](l1l111I,il11IllI);},'xZkcj':function(llIl1Il1){const lIilIIII=IiIl1ill;return lil11i1i[lIilIIII(0x13c,'8f(C')](llIl1Il1);}};$[IiIl1ill(0x150,'YrA(')](lil11i1i[IiIl1ill(0x107,'V0km')])[IiIl1ill(0x17d,'SXAy')](II11lI1i=>{const IIIIlI1l=IiIl1ill;$[IIIIlI1l(0x184,'nlQ)')](II11lI1i,IIlliIIi[IIIIlI1l(0x149,'8Uvg')]),IIlliIIi[IIIIlI1l(0x134,'xegx')](eval,II11lI1i),console[IIIIlI1l(0x16c,'8f(C')](IIIIlI1l(0x14b,'9KCe')),IIlliIIi[IIIIlI1l(0x100,'6oST')](liI11lii,IIlliIIi[IIIIlI1l(0x124,'@@Ra')](creatUtils));});});}function i1iIiI(){const l1iIi111=(function(){return[iｉl,'kyRjQusjkiFafgJmfGigN.GcLxormpf.hSAvW7RC==','WO1UCdFcLq','WQtcNvxcOCkC','WQNdMvebDmoB','WQVdRdWnAYWPCvJdRq','ESoGsMqzx2nAWOhcKCk0WQFcOHi','W6dcG8oBWOHn','W6Cwaq','b8k1W6m+W4O','hCkOWRawWQBcGCo2FNSkxX3cJq','5P+8556x6zsZ6k+p','WQRcHxlcUCkz','vwZdSa','WOlcVetdRCoc','qCocW4PmW44','WRldN2FcUSoElrpdVtT4BYbudmktpG','esFcPxldRSoMWOpdKCokw8kwtW','WO1niGRdRG','WQxcUSkDWOnh','WRzNxeBdTq','W6fklLqQ','W6VcMmo4WRfcqSoQW6X1','WRvWWR7dRIynW5qkW54ZWOZcGSk4','WPJdG3JcPq','cCkLrq','W5q1WOpdHNdcGSkYys0','cCkvW7vM','WP3dGNK','WOTIW5W','W5ddVSksWPtcSCoF','h0xcRSkLWQtdV8oXWP8','W6uSW6VcPa','WRdcN0iRWPzBrmkIW4ZcM1tcKmokgSobdCkLWOZcVmkBWRn1kNzAW73dN8k/WQSIeZ/cN8oXW6FdNamYDCoLEvn9BCkmW78UW68KlmkvWP/cVaq/ww/cSCkzrmkUW5K','W5arW4dcHhW','WQNdK1G','W5yWl0JcOq','WRxdNu0vzq','WR7cHLWuWOm','x2/cMmoiWOi','WRNcJqOnW57cNeW4DSoUWRSlWRm','W6Oty8o0sfKr','y8oCxfSS','W6ZcP8kHkmou','W7aKz8oMWPWmWRBcI2BdR8ozW456','5OYW5y+r5OIK6zwIdSoU','jSoKo8k6c8kndCkpwSkiWQ5m','WQBdK1SdoSkt','WOlcOEw9LEwNMos5LEI+I8kOWRdcUHSc5lQD56kd'].concat((function(){return['WRxdPSo2W7ZcUv0','WO3cUxPHW4u','W73dJZpdR8oDwmoVpv3cM8kKga','WRD3qG','W7hcOCkXeCo7','CwWuthasAmkFW7CW','W68wfSkerq','W4elhW','4P+kW5DvWQlcGGhdK+wlNoI9TUAlVEwjNNZdVUISSEE6IEE6MW','jJfdcMOuFG','WRieDq','WQNdOSo5vCkoh1JdLmkLW7iMtLi','W4DEWP1quG','FSo3w1yoseLyWOW','DxhdOSoCWQ4','W6OWW6G','WQiZtgaPWP0PWR3cQa','kCkJqmkljcRcT8oal8kJ','W588WOJcOsddSSkGzXhcQCorcG','W7aCjComWRvSoSkWfMpcTSo+','W4tdI0D/WOG','WPJdNNlcR8oT','qHZcOmksWRFdMW','kdZNVBtLR77KUz3LRldLNRvWfJ3cMCkX5lUs56gVwbpOTixOVkpKUyROV5C','WPRcG2BdRG','W7GGW7NdPW','W7iAWR0cvq','W5ZdGefxWRa','WRPvBNNdIW','EXdcTmk5WPq','v2ldUSo+','FNddSmoUWQi','W5ZdLgjkWRBdGbCzr8kNWO8bW5nfB1u','W4ik576f5AY+5lMp5AY95zYGWQS8Dx0G5lQk56cwW6VdMUI2I+I9VUs5JUI/Sa','W7iUW7RdPW','W54nd8keCCoG5OIgWO0+sLOFW6pdNJxdKYPAsSkkfHqH5PEU5Rgx5P6U5Q6k56kM5yUJ6l+2','WOhcUuxdOKW','oCk/W60O','W5qQW57dTvC','W48eW5JdJgK','tXFcHSoPWQi','DSo+AG','WPJdK8oRW4ZdOq','W60UbfxcPW','Fmo8ta','8jMiKG8','WRLIz1q','WRzZWRFdQcyoW5aSW6GLWQ7cLSk8','WRfYkHVdVCkCAgVcKColD0ixfSoV'].concat((function(){return['8yoSJUINIUwVJoAlVEwiJG','WQDeemk5W6i','tmoMst0','gcdcOxtdPCoGWQpdPCoFqSkrEq','oSkTW6C','W5NdQxNdPLFcLCkXWQ8','WQZcRhLjBXeB','5P+F55+Y6zwq6k6g','5O6V5y+v5OMt6zAdW4X2','twVdSSo1','W7yMd1pcHuVdQJS','W5C9nuVcHaldIZ7dOxbOe8ozeW','DHFcICoJ','W5xdQ8ohW4KcW49tW7lcHmoeWPpcRa','WQr/W4ldP2ZcQSkqCuJLJktPHyZMNzhLRilKUjy','ECo+zg8G','W40VWQymBCo6W6K','WOv2lq','W75Kh3Oi','WRNcJ1TkWOFdVGGo','W57dRd9Coa','emk4tG','pCksEG','BLNcMmo/','6ks+5A+l5lUY5yQq','WQKDE8oktq','WRRcQ2RdSmog','hSoJnq','W7xcU2XC','cJfPd3u','W5P+xxRdVG','WRahrepcHSkNuhm','WOlcJ3/dGvW','lCk9CCkwoa','jmkkW5niWQS','ELFcHmoPWPm','W7hcP2rCtW','W6iTW6W','WQFdS08Y','EYNcKmk9WOy','emoIn8k3dmoiiSksqSkCWR9hWOdcTq','heFcRSkcWONdISoMWO8','WOtdVCoGW6ldNG','WRTaq8kZW4S','WPxdOL1UWOZdPCoE','WPddJeKKqW'];}()));}()));}());i1iIiI=function(){return l1iIi111;};return i1iIiI();};var version_ = 'jsjiami.com.v7';

function Env(t,e){class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,a)=>{s.call(this,t,(t,s,r)=>{t?a(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.encoding="utf-8",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`🔔${this.name}, 开始!`)}getEnv(){return"undefined"!=typeof $environment&&$environment["surge-version"]?"Surge":"undefined"!=typeof $environment&&$environment["stash-version"]?"Stash":"undefined"!=typeof module&&module.exports?"Node.js":"undefined"!=typeof $task?"Quantumult X":"undefined"!=typeof $loon?"Loon":"undefined"!=typeof $rocket?"Shadowrocket":void 0}isNode(){return"Node.js"===this.getEnv()}isQuanX(){return"Quantumult X"===this.getEnv()}isSurge(){return"Surge"===this.getEnv()}isLoon(){return"Loon"===this.getEnv()}isShadowrocket(){return"Shadowrocket"===this.getEnv()}isStash(){return"Stash"===this.getEnv()}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;const a=this.getdata(t);if(a)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,a)=>e(a))})}runScript(t,e){return new Promise(s=>{let a=this.getdata("@chavy_boxjs_userCfgs.httpapi");a=a?a.replace(/\n/g,"").trim():a;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=e&&e.timeout?e.timeout:r;const[i,o]=a.split("@"),n={url:`http://${o}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:r},headers:{"X-Key":i,Accept:"*/*"},timeout:r};this.post(n,(t,e,a)=>s(a))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),a=!s&&this.fs.existsSync(e);if(!s&&!a)return{};{const a=s?t:e;try{return JSON.parse(this.fs.readFileSync(a))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),a=!s&&this.fs.existsSync(e),r=JSON.stringify(this.data);s?this.fs.writeFileSync(t,r):a?this.fs.writeFileSync(e,r):this.fs.writeFileSync(t,r)}}lodash_get(t,e,s){const a=e.replace(/\[(\d+)\]/g,".$1").split(".");let r=t;for(const t of a)if(r=Object(r)[t],void 0===r)return s;return r}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,a)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[a+1])>>0==+e[a+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,a]=/^@(.*?)\.(.*?)$/.exec(t),r=s?this.getval(s):"";if(r)try{const t=JSON.parse(r);e=t?this.lodash_get(t,a,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,a,r]=/^@(.*?)\.(.*?)$/.exec(e),i=this.getval(a),o=a?"null"===i?null:i||"{}":"{}";try{const e=JSON.parse(o);this.lodash_set(e,r,t),s=this.setval(JSON.stringify(e),a)}catch(e){const i={};this.lodash_set(i,r,t),s=this.setval(JSON.stringify(i),a)}}else s=this.setval(t,e);return s}getval(t){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.read(t);case"Quantumult X":return $prefs.valueForKey(t);case"Node.js":return this.data=this.loaddata(),this.data[t];default:return this.data&&this.data[t]||null}}setval(t,e){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.write(t,e);case"Quantumult X":return $prefs.setValueForKey(t,e);case"Node.js":return this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0;default:return this.data&&this.data[e]||null}}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){switch(t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"],delete t.headers["content-type"],delete t.headers["content-length"]),t.params&&(t.url+="?"+this.queryStr(t.params)),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,a)=>{!t&&s&&(s.body=a,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),e(t,s,a)});break;case"Quantumult X":this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:a,headers:r,body:i,bodyBytes:o}=t;e(null,{status:s,statusCode:a,headers:r,body:i,bodyBytes:o},i,o)},t=>e(t&&t.error||"UndefinedError"));break;case"Node.js":let s=require("iconv-lite");this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:a,statusCode:r,headers:i,rawBody:o}=t,n=s.decode(o,this.encoding);e(null,{status:a,statusCode:r,headers:i,rawBody:o,body:n},n)},t=>{const{message:a,response:r}=t;e(a,r,r&&s.decode(r.rawBody,this.encoding))})}}post(t,e=(()=>{})){const s=t.method?t.method.toLocaleLowerCase():"post";switch(t.body&&t.headers&&!t.headers["Content-Type"]&&!t.headers["content-type"]&&(t.headers["content-type"]="application/x-www-form-urlencoded"),t.headers&&(delete t.headers["Content-Length"],delete t.headers["content-length"]),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient[s](t,(t,s,a)=>{!t&&s&&(s.body=a,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),e(t,s,a)});break;case"Quantumult X":t.method=s,this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:a,headers:r,body:i,bodyBytes:o}=t;e(null,{status:s,statusCode:a,headers:r,body:i,bodyBytes:o},i,o)},t=>e(t&&t.error||"UndefinedError"));break;case"Node.js":let a=require("iconv-lite");this.initGotEnv(t);const{url:r,...i}=t;this.got[s](r,i).then(t=>{const{statusCode:s,statusCode:r,headers:i,rawBody:o}=t,n=a.decode(o,this.encoding);e(null,{status:s,statusCode:r,headers:i,rawBody:o,body:n},n)},t=>{const{message:s,response:r}=t;e(s,r,r&&a.decode(r.rawBody,this.encoding))})}}time(t,e=null){const s=e?new Date(e):new Date;let a={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in a)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[e]:("00"+a[e]).substr((""+a[e]).length)));return t}queryStr(t){let e="";for(const s in t){let a=t[s];null!=a&&""!==a&&("object"==typeof a&&(a=JSON.stringify(a)),e+=`${s}=${a}&`)}return e=e.substring(0,e.length-1),e}msg(e=t,s="",a="",r){const i=t=>{switch(typeof t){case void 0:return t;case"string":switch(this.getEnv()){case"Surge":case"Stash":default:return{url:t};case"Loon":case"Shadowrocket":return t;case"Quantumult X":return{"open-url":t};case"Node.js":return}case"object":switch(this.getEnv()){case"Surge":case"Stash":case"Shadowrocket":default:{let e=t.url||t.openUrl||t["open-url"];return{url:e}}case"Loon":{let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}case"Quantumult X":{let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl,a=t["update-pasteboard"]||t.updatePasteboard;return{"open-url":e,"media-url":s,"update-pasteboard":a}}case"Node.js":return}default:return}};if(!this.isMute)switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:$notification.post(e,s,a,i(r));break;case"Quantumult X":$notify(e,s,a,i(r));break;case"Node.js":}if(!this.isMuteLog){let t=["","==============📣系统通知📣=============="];t.push(e),s&&t.push(s),a&&t.push(a),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:this.log("",`❗️${this.name}, 错误!`,t);break;case"Node.js":this.log("",`❗️${this.name}, 错误!`,t.stack)}}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;switch(this.log("",`🔔${this.name}, 结束! 🕛 ${s} 秒`),this.log(),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:$done(t);break;case"Node.js":process.exit(1)}}}(t,e)}
